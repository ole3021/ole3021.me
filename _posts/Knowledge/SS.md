---
title: "è‡ªå»ºShadowSocksæœåŠ¡å¤‡å¿˜å½•"
meta: "é€šè¿‡æ‰‹åŠ¨åœ¨è™šæ‹Ÿäº‘ä¸»æœºä¸Šæ­å»ºå®ç°ShadowSocksæœåŠ¡ï¼Œå¹¶ä½¿ç”¨Google BBRæ¥åŠ é€Ÿè®¿é—®é€Ÿåº¦ã€‚"
category: Knowledge
tags: [sss]
cover: /assets/images/post/sss.jpg
color: '#606060'
created: 2017-08-08
---

# è‡ªå»ºShadowSocksæœåŠ¡å¤‡å¿˜å½•

## è´­ä¹°äº‘ä¸»æœº

### Vulträ¸»æœº

é¦–å…ˆéœ€è¦è´­ä¹°äº‘ä¸»æœº(VPNæœåŠ¡å™¨) ï¼Œæ¨è[Vultræ—¥æœ¬](http://www.vultr.com/?ref=7092244)æœºæˆ¿ä¸»æœº, ç›¸æ¯”å…¶ä»–äº‘ä¸»æœºä¸»è¦ç½‘ç»œæµé‡æ›´å¤š(5ç¾å…ƒ1000Gæµé‡),å¦å¤–ä¸»æœºæ€§èƒ½ä¹Ÿæ›´å¼º(å®˜æ–¹æ•°æ®).

![vultr-performance](/assets/images/post/vultr-performance.png)

ä¸è¿‡ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ä¸»æœºã€‚é™„ä¸Šä¸€å¼ ä¸ªä¸»æœºæ€§ä»·æ¯”å¯¹æ¯”å›¾(æ¥è‡ªç½‘ç»œ)ã€‚

![plan-vs](/assets/images/post/plan-vs.png)

Vulträ¸»æœºç›®å‰æœ‰15ä¸ªæœºæˆ¿(@Aug, 2017),  æ¨èå…¶ä¸­äºšæ´²åŒºçš„æ—¥æœ¬æœºæˆ¿ï¼Œæ„Ÿå…´è¶£ä¹Ÿå¯ä»¥é€šè¿‡[Vulträ¸»æœºå»¶è¿Ÿæµ‹è¯•](http://cloudharmony.com/speedtest-latency-for-vultr:compute)

> æµ‹è¯•ç»“æœä¸åŒ…å«æ–°åŠ å¡æœºæˆ¿ï¼Œç»“æœå»¶è¿Ÿå’Œå®é™…æœåŠ¡å™¨çš„ipåœ°å€æµ‹è¯•ç»“æœç•¥å¾®åé«˜

æ¥æ£€æŸ¥é€‚åˆè‡ªå·±ä½ç½®çš„æœºæˆ¿ã€‚å†ä¸Šæµ·çš„æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š

![lagency-test](/assets/images/post/lagency-test.png)

> å¯ä»¥åœ¨Vultråˆ›å»ºä¸»æœºåç”¨çœŸå®çš„ä¸»æœºipåœ°å€æµ‹è¯•ï¼Œæµ‹è¯•å®Œåˆ æ‰å³å¯ã€‚

æˆ‘è‡ªå·±æµ‹è¯•çš„ç»“æœæ˜¯ï¼Œå†ä¸Šæµ·ï¼ˆç”µä¿¡ï¼‰è®¿é—®çš„è¯å®æµ‹ç»“æœå¦‚ä¸‹ï¼š

* ğŸ‡¯ğŸ‡µæ—¥æœ¬æœºæˆ¿å¹³å‡:90æ¯«ç§’
* ğŸ‡¸ğŸ‡¬æ–°åŠ å¡å¹³å‡:160æ¯«ç§’
* ğŸ‡ºğŸ‡¸ç¾å›½Los Angelesæœºæˆ¿å¹³å‡:140æ¯«ç§’

å…¶ä»–æœºæˆ¿æµ‹è¯•åœ°å€(å®˜æ–¹æä¾›)

| Location                   | Domain                   | Result(Shang Hai) |
| -------------------------- | ------------------------ | ----------------- |
| Frankfurt, DE              | fra-de-ping.vultr.com    | 330ms             |
| Paris, France              | par-fr-ping.vultr.com    | 250ms             |
| Amsterdam, NL              | ams-nl-ping.vultr.com    | 240ms             |
| London, UK                 | lon-gb-ping.vultr.com    | 190ms             |
| Singapore                  | sgp-ping.vultr.com       | 180ms             |
| New York (NJ)              | nj-us-ping.vultr.com     | 330ms             |
| Tokyo, Japan               | hnd-jp-ping.vultr.com    | 90ms              |
| Chicago, Illinois          | il-us-ping.vultr.com     | 280ms             |
| Atlanta, Georgia           | ga-us-ping.vultr.com     | 520ms             |
| Miami, Florida             | fl-us-ping.vultr.com     | 350ms             |
| Seattle, Washington        | wa-us-ping.vultr.com     | 330ms             |
| Dallas, Texas              | tx-us-ping.vultr.com     | 200ms             |
| Silicon Valley, California | sjo-ca-us-ping.vultr.com | 200ms             |
| Los Angeles, California    | lax-ca-us-ping.vultr.com | 140ms             |
| Sydney, Australia          | syd-au-ping.vultr.com    | 220ms             |

æ¨èé€‰æ‹©æ—¥æœ¬æˆ–è€…Los Angelesä¸»æœºï¼Œæ—¥æœ¬ä¸»æœºæ›´å¿«ï¼Œä½†æ˜¯å­˜åœ¨ä¸å°çš„ä¸¢åŒ…ç‡ï¼Œæ´›æ‰çŸ¶å¹³å‡æ…¢40msï¼Œä½†æ˜¯ç½‘ç»œç¨³å®šæ— ä¸¢åŒ…ï¼Œå¦å¤–åœ¨ä½¿ç”¨VPNæ—¶ä¸ä¼šæ ¹æ®ä½ç½®é»˜è®¤æ˜¾ç¤ºæ—¥æœ¬ç½‘ç«™ã€‚

![ping-result](/assets/images/post/ping-result.png)

Vulträ¸»æœºé€‰æ‹©é…ç½®å¦‚ä¸‹ï¼š

1. Server Location (Tokyo)

2. Server Type(CentOS 7 x64)

3. Server Size($5/mo 1000GB Bandwidth)

4. Additional Features(ä¸é€‰)

5. Startup Script(ä¸é…ç½®)

6. SSH Keys

   é€šè¿‡SSHæ–¹å¼å¯ä»¥æ›´å®‰å…¨å’Œæ–¹ä¾¿çš„ç™»é™†(ä¸éœ€è¦å¯†ç )ï¼Œå…³äºSSHåˆ›å»ºçš„æ–¹å¼å‚è§[Github SSH Keyæ•™ç¨‹](https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/)(è¿™é‡Œçš„SSHåˆ›å»ºä¼šè·³è½¬åˆ°ç®¡ç†é¡µé¢)ï¼Œä¹Ÿå¯ä»¥ä¸å¡«å†™ï¼Œåˆ›å»ºæˆåŠŸåä¼šå¯ä½¿ç”¨æä¾›çš„é»˜è®¤ç®¡ç†å‘˜çš„è´¦å·å¯†ç SSHç™»é™†ã€‚

7. Server Hostname & Label(ä¸»æœºhostå¡«å†™åéœ€è¦é‡è£…æ‰èƒ½ä¿®æ”¹ï¼Œé»˜è®¤æ˜¯vultr.com,ä¸è¿‡æ— å…³ç´§è¦)

### å®‰è£…æœåŠ¡

1. ç™»é™†ä¸»æœº

    ```
    ssh root@æœåŠ¡å™¨IPåœ°å€
    ```
    ---
    >  å¯†ç åœ¨æœåŠ¡å™¨è¯¦æƒ…ä¸­å¯ä»¥æ‰¾åˆ°

2. æ£€æŸ¥CentOSå†…æ ¸å¹¶å‡çº§åˆ°æœ€æ–°ä»¥åŠå®‰è£…BBR

    ```
    wget -O- https://raw.githubusercontent.com/ole3021/scripts/master/centOS_BBR.sh | bash
    ```

3. é‡å¯å¹¶æ£€æŸ¥kernelå‡çº§åˆ°æœ€æ–°ä»¥åŠBBRå®‰è£…æˆåŠŸ

    ```
    reboot
    uname -sr
    sysctl -a|grep congestion_control
    ```

4. å®‰è£…pipå’Œshadowsocks

    ```
    yum install python-setuptools && easy_install pip
    pip install shadowsocks
    ```

5. åˆ›å»ºSSçš„é…ç½®æ–‡ä»¶ `/etc/shadowsocks.json`

    ```
    {
        "server": "0.0.0.0",
        "server_port": 8388,
        "password": "uzon57jd0v869t7w",
        "method": "aes-256-cfb"
    }
    ```
    ---
    > * `method`ä¸ºåŠ å¯†æ–¹æ³•ï¼Œå¯é€‰`aes-128-cfb, aes-192-cfb, aes-256-cfb, bf-cfb, cast5-cfb, des-cfb, rc4-md5, chacha20, salsa20, rc4, table`
    > * `server_port`ä¸ºæœåŠ¡ç›‘å¬ç«¯å£
    > * `password`ä¸ºå¯†ç 

6. é…ç½®SSå¯åŠ¨è„šæœ¬ `/etc/systemd/system/shadowsocks.service`

    ```
    [Unit]
    Description=Shadowsocks

    [Service]
    TimeoutStartSec=0
    ExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json

    [Install]
    WantedBy=multi-user.target
    ```

7. å¯åŠ¨SSæœåŠ¡

    ```
    systemctl enable shadowsocks
    systemctl start shadowsocks
    ```

8. æ£€æŸ¥SSçŠ¶æ€

    ```
    systemctl status shadowsocks -l
    ```
    æœåŠ¡å¯åŠ¨æˆåŠŸåä¼šæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹

    ```
    â— shadowsocks.service - Shadowsocks
        Loaded: loaded (/etc/systemd/system/shadowsocks.service; enabled; vendor preset: disabled)
        Active: active (running) since Sun 2017-08-20 12:19:37 UTC; 11s ago
    Main PID: 10263 (ssserver)
        CGroup: /system.slice/shadowsocks.service
                â””â”€10263 /usr/bin/python /usr/bin/ssserver -c /etc/shadowsocks.json

    Aug 20 12:19:37 vultr.guest systemd[1]: Started Shadowsocks.
    Aug 20 12:19:37 vultr.guest systemd[1]: Starting Shadowsocks...
    Aug 20 12:19:37 vultr.guest ssserver[10263]: INFO: loading config from /etc/shadowsocks.json
    Aug 20 12:19:37 vultr.guest ssserver[10263]: 2017-08-20 12:19:37 INFO     loading libcrypto from libcrypto.so.10
    Aug 20 12:19:37 vultr.guest ssserver[10263]: 2017-08-20 12:19:37 INFO     starting server at 0.0.0.0:3021
    ```

9. å¼€æ”¾é˜²ç«å¢™ç›¸åº”çš„ç«¯å£

    ```
    firewall-cmd --permanent --add-port=xxxx/tcp //xxxx ä¸ºè®¾ç½®çš„ssæœåŠ¡ç«¯å£
    firewall-cmd --reload
    ```
    ---
    >æˆåŠŸåä¼šæ˜¾ç¤º`success`

## è¿æ¥SSæœåŠ¡

è¿æ¥SSæ¨èä½¿ç”¨ä»¥ä¸‹å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥

* Mac [ShadowsocksX-NG](https://github.com/shadowsocks/ShadowsocksX-NG)
* Windows [shadowsocks-windows](https://github.com/shadowsocks/shadowsocks-windows)

### TODO

- [ ] æ•´åˆéƒ¨ç½²å®‰è£…ä»£ç ä¸ºè„šæœ¬æ–¹ä¾¿å®ç”¨
